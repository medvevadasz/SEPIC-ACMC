Closed loop Peak Current Mode Control System
============================================

A) Introduction
================
All hardware and microcontroller related settings are entered in file globals.h by entering physical 
values like frequencies in [Hz], time in [sec], voltages in [V] or duty ratios in [%].
Pre-compiler macros are used to translate these settings into integer numbers, which will be programmed
into the Special Function Registers (SFRs) during runtime.

B) Converter Function and Behavior
===================================
The Single-Ended Primary-Inductor Converter (SEPIC) supports output power levels up to 20W.

    Switching Frequency: 350 kHz
    Maximum Duty Ratio:   80%

    VIN:  7...20 V
    VOUT: 9...24 V (programmable)*
    IOUT: 0.02 ... 1A

*): Output voltage currently limited to 18V max by output voltage divider ratio

1) Startup
===========
The startup procedure is taking place automatically. The startup behavior can be adjusted in three 
intervals:
                             _____________________
                            /
                           / |           |
                          /  |           |
                         /   |           |
                        /    |           |
                       /     |           |
   VOUT ______________/      |           |
        |             |      |           |
        |----PODLY----|-RPER-|---PGDLY---|-COMPLETE-

    PODLY: Power On Delay, specified in [sec] (e.g. 500e-3)
    RPER:  Ramp-Up Period, specified in [sec] (e.g. 50e-3)
    PGDLY: Power Good Delay, specified in [sec] (e.g. 100e-3)

After initializing the power controller and its peripherals, the power control state machine waits 
in status STANDBY until all fault flags have been cleared, ADC is running, the power controller
is enabled and the GO-bit has been set. If the option AUTO_STARTUP is set, the power controller 
is enabled and the GO-bit is set automatically and the startup procedure will be initiated immediately
without being triggered by a software command.

2) Peripheral Configuration and Utilization
============================================
The peripherals used to establish a peak-current mode feedback loop includes:

    - PG1:  PWM Generator driving the main switch of the SEPIC on pin PWM1H
    - PG2:  PWM Generator used as comparator acceptance filter during the main switch on-time
            and also providing the ADC trigger to sample the SEPIC output voltage
    - DAC/CMP1: DAC peripheral with high-speed analog comparator triggering the active on-time
            when the current sense signal crosses the reference voltage provided by the DAC
    - SLP1: Slope compensation ramp generated by the DAC preventing sub-harmonic oscillations
            when the converter is running in fixed frequency, continuous conduction mode
    - AN16: Analog input used to sample the SEPIC output voltage via ADC core #2 (shared ADC core)
            Its Interrupt Service Routine (ISR) is also used to call the outer voltage loop of the 
            power supply controller

User Option:
-------------

    - AN6: Analog input used to sample an external voltage reference signal between 0 ... 3.3V

3) Debugging Header J2 Signals
===============================
The 00128 SEPIC topology board, Rev. 1.0 offers debugging signals on header J2:

    - DACOUT: Digital-To-Analog converter output allowing access to the internal reference voltage 
            signal applied to the high-speed comparator. This signal is used to inspect the reference
            level and slope compensation ramp signal.
    - AN15: Analog input used to sample an external voltage reference signal (for details see below)
    - GND:  Signal ground for external reference voltage signal
    - RX:   General purpose IO, can be used as generic debugging signal output or UART Receive Line RX*
    - TX:   General purpose IO, can be used as generic debugging signal output or UART Transmit Line TX*

*) In this version, signals used as GPIO debugging signal output by firmware

4) External Voltage Reference Input
====================================
Pin AN15 at debugging header J2 can be used to inject an external reference voltage signal to manually
adjust the output voltage. The analog signal range is AVSS to AVDD (0 ... 3.3 V DC). 
These voltage rails should not be exceeded by more than 200 mV (e.g. AVSS - 0.2V or AVDD + 0.2 V) to
prevent undefined behavior or damages.

The external reference voltage signal is read directly by the Analog-To-Digital converter (ADC).
The sampled value is scaled as number between 0 ... 1 (0-100%).

    VREF_MAX _ _ _ _ ______________________________
                      |
                      |
                      |    ADJUSTABLE RANGE
                      |  (VREF_MAX - VREF_MIN)
                      |       (0 ... 100%)
                      |
    VREF_MIN _ _ _ _ ______________________________

The limits VREF_MIN and VREF_MAX are set in file globals.h

    - VREF_MIN: Minimum output voltage level in [V] (e.g. V_REF_MINIMUM  9.0)
    - VREF_MAX: Maximum output voltage level in [V] (e.g. V_REF_MAXIMUM  18.0)
    
Please note:
~~~~~~~~~~~~~

For a correct result the following parameters have to be set in accordance with the hardware used:

    - SEPIC_VOUT_R1: Upper voltage divider resistor in kOhm (e.g. (2.87 + 2.87) when more than one resistor is used)
    - SEPIC_VOUT_R2: Lower voltage divider resistor in kOhm (e.g. 1.0 for 1 kOhm)

5) Limitations (as of 07/3072019)
=================================
This firmware is still under development. Future releases may add new features.
Here are the most significant limitations:

a) Fault Handling
~~~~~~~~~~~~~~~~~~
Up to now there is no fault handling firmware. Input voltage is not monitored and any
violation of specified limits will go without response. In case of low-line the duty ratio
will be clamped at maximum on-time, the control loop will saturate and the output voltage 
will drop until the VDD of the dsPIC DSC drops below minimum and the power supply shuts down.

In case of high-line (over voltage) there will be no self-protecting shut-down. High input voltages
exceeding the specified range may therefore permanently damage the power converter.




=========================================================
(c)2019, Microchip Technology Inc.

